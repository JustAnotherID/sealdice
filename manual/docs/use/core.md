---
lang: zh-cn
title: 核心指令
---

# 核心指令



`核心指令`是无法被关闭的指令。

与之相对的概念是`扩展指令`，扩展指令可以被关闭。

举例来说，输入`.ext coc7 off`关闭coc7扩展，那么相关的指令，例如`.st` `.sc` `.ra` `.setcoc`等就不会响应了。

##  .r 骰点

格式: `.r <表达式> (<原因>)`

别名: `.roll` `.rd`

可用范围: 群内、私聊



### 常用示例

特别提醒一下，如果不写骰子算符(d/b/p，概念见下)，r指令相当于计算器

```
.r
Dice: <木落>掷出了 D100=69

.r d50
Dice: <木落>掷出了 d50=[1d50=48]=48

.r d50 天气不错
Dice: 由于天气不错，<木落>掷出了 d50=[1d50=4]=4

.r 5d24 骰5个24面骰
Dice: 由于骰5个24面骰，<木落>掷出了 5d24=[5d24=60, 7+20+15+1+17]=60

.r 4d6k3 骰4个6面骰，选3个最大的
Dice: 由于骰4个6面骰，选3个最大的，<木落>掷出了 4d6k3=[{6 5 3 | 1 }]=14

.r 100 + 3 * 2
Dice: <木落>掷出了 100 + 3 * 2=100 + 6=106
```



### 奖励骰/惩罚骰

一类特殊的骰子，线下游戏时，D100是两个10面骰骰出来的，一个是个位，一个是十位。

如果十位骰为10，个位骰为1-9，那么结果是1-9（十位视为0）

如果两个10面骰都骰到10，那结果就是100

奖惩骰的机制是，多指定数量个十位骰，例如获得2个奖励骰，那么就丢3个十位骰。

假设十位骰结果是{4,5,8}，个位骰结果是2，那么最终结果就是42（取好的结果）

如果是惩罚骰，那么最终结果是82（取坏的结果）

```
.r b
Dice: <木落>掷出了 b=[D100=72, 奖励 4]=42

.r b3
Dice: <木落>掷出了 b3=[D100=96, 奖励 4 6 3]=36

.r p4 惩罚骰
Dice: 由于惩罚骰，<木落>掷出了 p4=[D100=87, 惩罚 5 7 8 7]=87
```



### 多轮骰点

```
.r 4#d10
Dice:
<木落>掷骰4次:
d10=[1d10=9]=9
d10=[1d10=3]=3
d10=[1d10=7]=7
d10=[1d10=8]=8
```



### DND5E优势骰劣势骰

```
.set 20
Dice:
设定默认骰子面数为 20
提示: 20面骰。如果要进行DND游戏，建议先执行.ext dnd5e on和.ext coc7 off以避免指令冲突

.r d20优势
Dice: <木落>掷出了 d20优势=[{7 | 6 }]=7

.r d劣势
<木落>掷出了 d劣势=[{16 | 18 }]=16
```

d20优势 = 2d20k1，即2个d20取结果高的一个

d20劣势 = 2d20q1，即2个d20取结果低的一个



### fvtt骰点兼容

```
.r d20kh  // 优势骰(其实不是特别兼容)
<木落>掷出了 d20kh=[{10 | 3 }]=10

.r d20kl  // 劣势骰
<木落>掷出了 d20kl=[{6 | 15 }]=6

.r 4d6dl1 // 丢4排除1个最低值
<木落>掷出了 4d6dl1=[{5 3 2 | 1 }]=10

.r 4d6dh1 // 丢4排除1个最高值
<木落>掷出了 4d6dh1=[{3 3 5 | 6 }]=11
```



### fate 命运骰

一种特殊的六面骰，六个面分别为 - - 0 0 + +，分别代表-1 0 1

骰点时投掷4次，加在一起为结果。例如某次结果是[-+++]，为-1 + 1 + 1 + 1 = 2

```
.r f
Dice: <木落>掷出了 f=[---+]=-2
```

带补正的情况:

````
.r f+1
<木落>掷出了 f+1=0[+0-0] + 1=1
````



### WOD/无限骰点

这是WOD骰点规则，国内更多见于无限团，默认使用d10。

这个规则需要设定几个参数：**骰池数量X、加骰线Y、成功线N**，其中XY是必须的，成功线默认为8

这是一个多轮骰点规则，骰X个d10，每有一个≥成功线的骰，成功数+1，每有一个≥加骰线的骰，加骰数+1，随后下一轮骰点使用上一轮的加骰数作为骰池数量。

```
.r 10a6k4m9
<木落>掷出了 10a6k4m9=[成功11/16 轮数:3 {1,<6*>,5*,3,<8*>,5*,<8*>,<6*>,2,<8*>},{5*,2,<9*>,1,4*},{5*}]=11
```

语法 XaYmZkN // X骰池数量，Y加骰线，m面数，N成功线(≥N记为一个成功)

特别的，若Y=0则不加骰，这也可以用到其他一些TRPG游戏中去。

同时，额外支持q参数(与k参数相对)，可使用q5参数计算≤5的骰数



### 双十字骰点

这是一种多轮的骰点规则。一般为骰若干个d10，并指定暴击值。

如果达到暴击值，则进入下一轮，直到全部骰子都不能暴击。

最终的骰点结果为: 暴击轮数 * 10 + 最后一轮中最大的点数

```
.r 4c3m7
<木落>掷出了 4c3m7=[出目32/9 轮数:4 {<4>,2,<4>,<5>},{<7>,1,2},{<7>},{2}]=32
```

骰4个d7，暴击值为3。若不设置m则为4个d10




### 混合运算

```
.r 30 + (-1d20) + 49
Dice: <木落>掷出了 30 + (-1d20) + 49=30 + -1[1d20=1] + 49=78

.r d50 * 3 + 2
Dice: <木落>掷出了 d50 * 3 + 2=21[1d50=21] * 3 + 2=65

.r d50 * 3 + (2 - p2) 多项式
Dice: 由于多项式，<木落>掷出了 d50 * 3 + (2 - p2)=25[1d50=25] * 3 + -64[D100=6, 惩罚 6 5]=11
```



事实上，海豹核心支持了这些算符：

**常用数学算符:** 加减乘除(+-*/)、乘方(**)、括号

**骰子算符:** 多面骰(d, <次数>d<面数>(k<个数>)(q<个数>))，奖励骰(b, b<个数>)、惩罚骰(p, p<个数>)



用字母表示的骰子算符有些反直觉，其实它们和加减乘除是一样的：

```
.r 1d1d1d1d1d1d1d1d1d1d1d1d1d1d(20+1d3*4)
Dice: <木落>掷出了 1d1d1d1d1d1d1d1d1d1d1d1d1d1d(20+1d3*4)=13

.r 1d10+(1+32)d(4*6)d20
Dice: <木落>掷出了 1d10+(1+32)d(4*6)d20=1[1d10=1] + 3941[33d24=384,384d20=3941]=3942
```



## .rh 暗骰

格式: `.rh <表达式> (<原因>)`

别名: `.rhd`

可用范围: 群内



这个指令的格式与`.r`完全相同，只不过效果是在群里撂下一句提示，然后把骰点结果私聊发给你。

不过注意！由于企鹅的严打，陌生人私聊极其容易触发风控，所以私聊发送只会发给好友。如果你不是骰子的好友，看不到任何结果。



```
// 群内
.rh d50
Dice: 命运正在低语！

// 私聊
Dice:
来自群<某个无聊团>(123)的暗骰:
<木落>掷出了 d10=[1d10=3]=3
```



## .rx / .rxh 特殊骰点

格式: `.rx <表达式> (<原因>)`

别名: 无

可用范围: 群内、私聊



这个指令和r指令的唯一区别是允许代骰，因此可以在骰点时读出属性：

```
.rx 聆听+d10 @木落
Dice: <木落>掷出了 聆听=[聆听=60] + 8[1d10=8]=68

.rx 侦查+1d20**2
Dice: <木落>掷出了 侦查+1d20**2=75[侦查=75] + 324[1d20=18]=399

.rx d(侦查)
Dice: <木落>掷出了 d(侦查)=[侦查=60,1d60=52]=52
```



## .bot 骰子管理

格式: `.bot on/off/bye/about`

别名: 无

可用范围: 群内、私聊



较为简单的指令，直接看例子：

```
.bot on // 开启
Dice: <海豹bot> 已启用 SealDice 0.99内测版 v20220312

.bot off // 关闭
Dice: <海豹bot> 停止服务

.bot bye // 退群
Dice: 收到指令，5s后将退出当前群组

.bot // 或者 .bot about
Dice: SealDice 0.99内测版 v20220312
供职于8个群，其中3个处于开启状态
上次自动保存时间: 2022-03-13 04:57:55 UTC
群内工作状态: 开启
```



## .nn 角色名设定

格式: `.nn // 查看当前角色名`

格式: `.nn (<角色名>)` // 修改角色名

格式: `.nn clr` // 重置角色名

别名: 无

可用范围: 群内



若有角色名参数，则进行设定。若无角色名，重置回默认名字。

```
.nn 简·拉基·茨德
Dice: <木落>(303451945)的昵称被设定为<简·拉基·茨德>

.r
Dice: <简·拉基·茨德>掷出了 D100=16

.nn
Dice: 玩家的当前昵称为: <简·拉基·茨德>

.nn clr
Dice: <木落>(303451945)的昵称已重置为<木落>
```



## .set 设定游玩规则/骰子面数

格式: `.set` // 查看当前面数设置

格式: `.set dnd` // 设置群内骰子面数为20，并自动开启对应扩展

格式: `.set coc/coc7` // 设置群内骰子面数为100，并自动开启对应扩展 

格式: `.set <面数>` // 设定群内骰子面数

格式: `.set <面数> --my` // 设定个人专属骰子面数

格式: `.set clr` // 清除群内骰子面数设置

格式: `.set clr --my` // 清除个人骰子面数设置

别名: 无

可用范围: 群内、私聊



```
.set 20
Dice: 设定默认骰子面数为 20

.set coc
设定群组默认骰子面数为 100
提示:已切换至100面骰，并自动开启coc7扩展

.set dnd
设定群组默认骰子面数为 20
提示:已切换至20面骰，并自动开启dnd5e扩展。

.set info
个人骰子面数: 0
群组骰子面数: 20
当前骰子面数: 20
```



设定骰子面数，默认值是100

优先级: **个人 > 群 > 默认(100)**

如果通过“规则模板”机制添加了自设规则，那么如有相关配置的话，可以使用.set切换为对应规则。

安装规则插件后，你可以通过.set help来查看新增的关键字。



## .pc 角色卡管理

格式:`.pc new <角色名>` // 新建角色并绑卡

格式:`.pc tag <角色名>` // 当前群绑卡/解除绑卡(不填角色名)

格式:`.pc untagAll <角色名>` // 全部群解绑

格式:`.pc list` // 列出当前角色

格式:`.pc save <角色名>` // [不绑卡]保存角色，角色名可省略

格式:`.pc load <角色名>` // [不绑卡]加载角色

格式:`.pc del/rm <角色名>` // 删除角色

可用范围: `群内、私聊`



**请特别注意这个指令！！**

海豹各群数据是独立的，也就是说相当于每个群都有一张空白卡。

因此**如果你在单群进行游戏**，那么并不需要录角色！也不会影响其他群的游戏！

```
.st clr // 如果这群有你的角色数据，先清掉
.nn 角色名
.st 力量50敏捷60
```

这样就可以直接开始游戏了。

如果跑完团想要在其他群使用这个角色，在使用`pc save 角色名`进行存卡。



如果你跑秘密团，那么需要用到绑卡功能，在小群：

```
.pc new 角色名 // 创建角色，并绑卡
.st 力量50敏捷60
```

然后在主群：

```
.pc tag 角色名
```

就可以了！这样两个群的角色数据是联动的。



## .find/.查询 查询指令

格式: `.find <关键字>` // 关键字可以多个，用空格分割

格式: `.find <数字ID>` // 显示该ID的词条

格式: `.find --rand` // 显示随机词条

别名: `.查询`

可用范围: 群内、私聊



海豹搭载了两个查询核心:

* 全文搜索 - 提供强大的索引功能，能够查询文档内容中的关键字，**但只能支持x86设备**。文档多的话会拖慢启动速度。
* 快速文档查找 - 只在标题中进行查找，速度很快。用于性能/内存受限的场景，以及手机端。



### 全文搜索！

来看看全文搜索吧，它非常强大，这是搭载了DicePP（梨骰）项目整理的查询资料后的效果：

```
.查询 30尺 法术

Dice:
全部结果:
[序号3066]【术士:超魔法:远程法术】 匹配度 0.16
[序号3015]【游侠:驯兽师:法术共享】 匹配度 0.13
[序号2396]【法术详述:迷踪步】 匹配度 0.12
[序号1319]【法术详述:阿迦纳萨喷火术】 匹配度 0.12
[序号507]【法术详述:智能堡垒/智力堡垒/智慧堡垒/智能壁垒/心智堡垒/心智壁垒】 匹配度 0.12
[序号2514]【法术详述:水下呼吸/水中呼吸】 匹配度 0.11
[序号2212]【法术详述:原力法阵】 匹配度 0.11
[序号1403]【法术详述:众星冠冕/星辰冠冕/星之冠冕】 匹配度 0.11
[序号2243]【法术详述:造水/枯水术/造水术/枯水术】 匹配度 0.11
[序号2176]【法术详述:秘法眼】 匹配度 0.11

(本次搜索由全文搜索完成)
```

因为多个文本匹配度相近，因此没有列出最佳匹配条目的正文内容。用这条指令可以查看：

```
.查询 2212
Dice:
词条: 法术详述:原力法阵
原力法阵 Circle of Power
圣武士
5环 防护
施法时间：1动作
施法距离：自身（30尺半径）
法术成分：V
持续时间：专注，至多10分钟
你身上发出神圣能量并以扭曲散溢的魔法能量构成一个半径30尺的球状力场。法术持续时间内力场将以你为中心随你移动。力场范围内的友方生物（包括你自己）为对抗法术或其他魔法效应而进行的豁免检定具有优势。此外，受本法术效应影响的生物在对抗豁免成功则伤害减半的法术或魔法效应时，若成功则不受伤害。
```

**这么好用，那代价是什么呢？**

更多的内存占用。变慢的启动速度。

给个参考：搭载了怪物之锤文本，以及梨骰DND查询包之后，海豹核心占据了80MB内存。

大致可以这样换算：**每1MB文本占15MB内存**



### 快速文档查找

指令是一样的，因此善乏可陈。

示例如下：

```
.find 测试词条
dice:
最优先结果:
词条: 测试:测试词条
他在命运的沉浮中随波逐流, 扮演着受害与加害者的双重角色

全部结果:
[序号2]【测试:测试词条】 匹配度 67.00

(本次搜索由快速文档查找完成)
```



### 致谢

默认搭载的几个示例文档：

其中COC《怪物之锤查询》的整理者为：**蜜瓜包**和**October**

COC魔法大典的整理者为：**魔骨、NULL、Dr.Amber**

DND系列资料的整理者主要为DicePP项目组成员，包括**Farevell**、**梨子**、**花作噫**、**邪恶**、**惠惠**、**赵小安**等

这些资料的原始出处和译者很多已经不可考，此处无法一一列出，甚为遗憾。

也在此感谢一代又一代无名作者和译者做出的工作。



## .help 帮助指令

格式: `.help (<词条名>)`

格式: `.help reload` // 重新装载帮助文档，仅master可用

别名: 无

可用范围: 群内、私聊



显示帮助



## .botlist 机器人列表

格式: `.botlist add @A @B @C` // 标记群内其他机器人，以免发生误触和无限对话

格式: `.botlist add @A @B --s` // 同上，不过骰子不会做出回复

格式: `.botlist del @A @B @C` // 去除机器人标记

格式: `.botlist list` // 查看当前列表

别名: 无

可用范围: 群内



这个指令用于标记群内的其他骰子或娱乐机器人，以便于各司其职。

被标记后会有如下效果：

1. 当有人@该骰发指令，海豹不会做出回应
2. 该骰发出的指令和消息，海豹不会回应，这可以有效避免关键词触发的无限复读

之所以不保留传统@效果，是因为海豹基于@功能做了一项扩展，其适用场景远多于同群多骰。

具体可以参见文档的这一节：**ra/rc 指令 -> [对他人做检定](#对他人做检定)**



示例:

```
.botlist add @某公骰
Dice:
新增标记了1个帐号，这些账号将被视为机器人。
因此别人@他们时，海豹将不会回复。
他们的指令也会被海豹忽略，避免发生循环回复事故
```

此外，被标记的当事人可以发出指令解除自己的标记。



## .ext 扩展管理

格式: `.ext <扩展名> on/off`  //开关

格式: `.ext <扩展名>` // 查看信息

格式:`.ext list`  // 查看扩展列表

可用范围: 群内



海豹除了核心指令之外，都被设计为可插拔的，目前有7个内置扩展。

关闭对应扩展会连同扩展带来的指令一块关闭。

注意！每个群可以分别开启不同的扩展。

```
.ext
Dice:
检测到以下扩展：
1. [开]coc7 - 版本:1.0.0 作者:木落
2. [开]log - 版本:1.0.0 作者:木落
3. [开]fun - 版本:1.0.0 作者:木落
4. [开]deck - 版本:1.0.0 作者:木落
5. [关]reply - 版本:1.0.0 作者:木落
6. [开]dnd5e - 版本:1.0.0 作者:木落
7. [开]story - 版本:1.0.0 作者:木落
使用命令: .ext <扩展名> on/off 可以在当前群开启或关闭某扩展。
命令: .ext <扩展名> 可以查看扩展介绍及帮助


.ext coc7 on
Dice: 打开扩展 coc7

.ext reply
Dice:
> [reply] 版本1.0.0 作者木落
> [尚未实现]智能回复模块，支持关键字精确匹配和模糊匹配
提供命令:
.reply


.ext reply off
Dice: 关闭扩展 reply

可以批量开启或关闭，如
.ext fun deck reply off
```

开启或关闭扩展能够直接改变骰子响应的命令。

例如coc7扩展提供了`.coc` /`.st` / `.ra` / `.rc` / `.sc` / `.setcoc` / `.ti` / `.li`一系列指令。

而dnd5e扩展提供`.st` `.rc` `.ri`

扩展关闭后，这些指令也会失效，可以有效避免指令混淆（**每个群都可以启用不同的扩展**）

例如我在A群打开`coc7`和`deck`两个扩展，B群可以只开启`deck`扩展，等等。

未来将制作更多官方扩展，以及提供自定义扩展脚本接口。

> 特别的，js插件可以创建扩展了，如果骰子安装了js插件，他可能会出现更多的扩展。



## .master 骰主指令

格式: `.master add me` // 将自己标记为骰主

格式: `.master add @A @B` // 将别人标记为骰主

格式: `.master del @A @B @C` // 去除骰主标记

格式: `.master unlock <密码(在UI中查看)>` // (当Master被人抢占时)清空骰主列表，并使自己成为骰主

格式: `.master list` // 查看当前骰主列表

格式: `.master relogin` // 30s后重新登录，有机会清掉风控(仅master可用)

格式: `.master list` // 查看当前骰主列表

格式: `.master reboot` // 重新启动(需要二次确认)

格式: `.master checkupdate` // 检查更新(需要二次确认)

别名: 无

可用范围: 群内、私聊

补充：这条指令做了@排除，如果存在@，且自己没有被@，不作回应。



对于一个无主骰，任何人都可以进行标记。

一旦有人成为骰主，此命令将只有骰主可以使用。

所有骰主都可以踢掉其他骰主，包括自己在内。

骰子的真正所有者，可以从后台看到解锁口令，来通过`.master unlock`命令直接取得骰主权限。



## .send 对骰主留言

格式: `.send <想说的话>`

格式: `.send to <对方ID> 要说的话 // 骰主回复，举例. send to QQ:12345 感谢留言`

别名: 无

可用范围: 群内、私聊

补充：这条指令做了@排除，如果存在@，且自己没有被@，不作回应。



给骰主留言吧！

不过首先，必须存在一名骰主，正如必须有一个巫妖王。

除了留言之外，骰主将看到你的名字和帐号。

如果是群内留言，还将看到群名和群号。



同样，骰主可以通过这个指令进行回复，对方会看到这样的回复内容：

```
本消息由骰主<木落>通过指令发送:
感谢反馈！
```



## .welcome 迎新设置 

格式: `.welcome on` // 开启

格式: `.welcome off` // 关闭

格式: `.welcome show` // 查看当前欢迎语

格式: `.welcome set <欢迎语>` // 设定欢迎语